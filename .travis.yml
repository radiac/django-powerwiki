os: linux
dist: xenial
language: python
install:
- pip install --upgrade pip wheel setuptools
- pip install --upgrade virtualenv tox
before_script:
- sh -c "if [ '$DATABASE_ENGINE' = 'pgsql' ]; then psql -c 'DROP DATABASE IF EXISTS
  gdpr_assist_tests;' -U postgres; fi"
- sh -c "if [ '$DATABASE_ENGINE' = 'pgsql' ]; then psql -c 'create database gdpr_assist_tests;'
  -U postgres; fi"
script:
- tox

jobs:
  include:

  - python: '3.7'
    env: TOXENV=py37-django2.2
  - python: '3.7'
    env: TOXENV=py37-django3.0
  - python: '3.7'
    env: TOXENV=py37-django3.1

  - python: '3.8'
    env: TOXENV=py38-django2.2
  - python: '3.8'
    env: TOXENV=py38-django2.2 DATABASE_ENGINE=mysql DATABASE_USER=travis
    services:
      - mysql
  - python: '3.8'
    env: TOXENV=py38-django2.2 DATABASE_ENGINE=pgsql DATABASE_USER=postgres
    services:
      - postgresql
  - python: '3.8'
    env: TOXENV=py38-django3.0
  - python: '3.8'

    env: TOXENV=py38-django3.1
  - python: '3.8'
    env: TOXENV=py38-django3.1 DATABASE_ENGINE=pgsql DATABASE_USER=postgres
    services:
      - postgresql

deploy:
  provider: pypi
  user: radiac
  password:
    secure: WuqRSaOjnXr23pa6EX6o99puXpMH2cJPDMNxytB6QROYNkgzjH1Zj3T8Ic9qwiAZwE2eJv/dSbp/u5s3GNsuEUE8BDYRUMytWhklgCsxoRf/P1e/4H1LqgCLG/5kJB3TMQb2RZVCYVcFcuXjfl3qa7InHgO5vVhTARvs8Ttm9F7vkCxWbj+5Q5pnQxxny+/SwmLGrPnwEQNCxZOLZK5+TIGywnHO9h8jlm+tRLuwJhMCfzta9iTsnvr4r5ZIa+qehTGXxGFIvLgNCvAj7yM/EEkrlbE2aG5y869BJe/x+dvcyOfNdvl6+FHa4Pu3yQ/S8bWQOMbgWpknEUwTpJS2HyZI4L5I9hPqx8ce48etrauoNrORSLffCJsWYIttnKCzzDh8PUgSxLoxcfn13TvFzC4NGTwcIgw2aT9AtxhquSjXwPrQ9FLcQi9Ci70BePoolRWcCh9xnHeEUPcJewg2H3Gb199naSHuccYvGBQCHijYrjGRcfKQmk0OwBL6U5mecGkma+RrcIctp/79GeZzm5TaJr/Wtgt1IVmP8FweVF04QkKR7mwoR0VVrVhQeQRnPWLi9y9w4G9KxB7oEGbEFVDdn/Su8gg4Wc3TS0suerfuee4FJJ9L+01QORz5/m+w4Jhrxmt3sOHC4E8IMrGm+GMZLKZcJ2AY1bSqf8nQgmQ=
  skip_existing: true
  on:
    tags: true
    distributions: sdist bdist_wheel
    repo: radiac/django-powerwiki
